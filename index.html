<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>開運傳聲揮春</title>
    <style>
        body {
            background-color: #e70012;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        button {
            background-color: transparent;
            border: none;
            padding-left: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <audio controls
        id="recording"
        preload="auto"
    ></audio>
    <br />
    <button id="share-btn">
        <img src="share.png" alt="share" />
    </button>
    <script>
        const params = new URL(window.location.href).searchParams;
        const recordingFilename = params.get('rid');

        const $audio = document.querySelector('#recording');
        const $shareBtn = document.querySelector('#share-btn');

        $audio.src = `https://pub-9d96e62182ac4492a2671a8880aaad8e.r2.dev/${recordingFilename}`;
        $audio.load();

        $shareBtn.addEventListener("click", async () => {
            const res = await fetch($audio.src);
            const blob = await res.blob();
            await navigator.share({
                title: '開運傳聲揮春',
                text: '點擊收聽我的新年祝福！',
                files: [
                    new File([blob], '開運傳聲揮春.wav', { type: blob.type })
                ]
            });
        });
    </script>
</body>
</html>
